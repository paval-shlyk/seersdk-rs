version: '3.8'

services:
  mocked-robot:
    # Option 1: Build locally (default)
    build:
      context: ..
      dockerfile: docker/mocked-robot.Dockerfile
    
    # Option 2: Use pre-built image from GitHub Container Registry
    # Comment out 'build' above and uncomment the line below:
    # image: ghcr.io/paval-shlyk/seersdk-rs/mocked-robot:latest
    
    image: mocked-rbk-robot:latest
    container_name: mocked-robot-server
    ports:
      # RBK Protocol ports
      - "19204:19204"  # State APIs
      - "19205:19205"  # Control APIs
      - "19206:19206"  # Navigation APIs
      - "19207:19207"  # Config APIs
      - "19208:19208"  # Kernel APIs
      - "19210:19210"  # Peripheral APIs
      # HTTP REST API port
      - "8080:8080"    # Waypoint management
    environment:
      - RUST_LOG=info
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/waypoints"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    restart: unless-stopped
    networks:
      - robot-network

networks:
  robot-network:
    driver: bridge
